/*!
 * sfdc.js 0.1.0
 * https://github.internal.sfmc.co/lzhu/sfdc.js.git
 */

!function(a,b){"use strict";"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define([],b):a.SFDC=b()}(this,function(){"use strict";var a;a=function(){function a(a){this.windowObject=a||{}}return a.prototype.isValid=function(){return this.windowObject&&this.windowObject.postMessage&&"function"==typeof this.windowObject.postMessage?!0:!1},a.prototype.post=function(a,b){if(b=b||{},this.isValid()!==!0)return!1;var c=JSON.stringify(b);return this.windowObject.postMessage.apply(this.windowObject,[c,a]),!0},a}();var b;return b=function(){function b(b,c){if(!b.parent||!b.parent.window)throw new Error("Expected window object to have a parent window.");if(this.windowFrame=new a(b.parent.window),this.setConnection(),this.connect(b),this.apiVersion=parseFloat(c),isNaN(this.apiVersion))throw new Error("Expected API version to be a number.")}function c(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function d(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)}var e=/^CONNECTED ([0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12})$/,f=/^\/[a-zA-Z]+$/;return b.prototype.setConnection=function(a,b){return this.connection=this.connection||{},a&&b?(this.connection.isConnected=!0,this.connection.session=a,this.connection.origin=b):(this.connection.isConnected=!1,this.connection.session="",this.connection.origin=""),this},b.prototype.isConnected=function(){var a=this.connection||{};return a.isConnected===!0},b.prototype.connect=function(a){if(this.isConnected())return!0;var b=this,f=function(c){var g=c.data;if("string"==typeof g&&0===g.indexOf("CONNECTED")){d(a,"message",f);var h=e.exec(g);if(h&&2===h.length){var i=h[1],j=c.origin;b.setConnection(i,j)}}};return this.windowFrame.post("*","CONNECT")&&c(a,"message",f),this},b.prototype.getConnectionOrigin=function(){var a=this.connection||{};return a.origin},b.prototype.isValidEndpoint=function(a){return a=a||"",f.test(a)},b.prototype.api=function(a,b){if(!this.isConnected())return!1;if(!this.isValidEndpoint(a))return!1;b=b||{};var c={endpoint:a,params:b,version:this.apiVersion};return this.windowFrame.post(this.getConnectionOrigin(),c)},b}()});
